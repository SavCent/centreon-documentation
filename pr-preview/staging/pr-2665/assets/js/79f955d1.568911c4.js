"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[50874],{20716:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>f,frontMatter:()=>p,metadata:()=>u,toc:()=>g});n(67294);var r=n(3905),a=n(51715),o=n(7626);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const p={id:"upgrade-from-centreon-failover",title:"Upgrade from Centreon-Failover to Centreon-HA"},d=void 0,u={unversionedId:"upgrade/centreon-ha/upgrade-from-centreon-failover",id:"version-22.04/upgrade/centreon-ha/upgrade-from-centreon-failover",title:"Upgrade from Centreon-Failover to Centreon-HA",description:"Prerequisites",source:"@site/versioned_docs/version-22.04/upgrade/centreon-ha/upgrade-from-centreon-failover.md",sourceDirName:"upgrade/centreon-ha",slug:"/upgrade/centreon-ha/upgrade-from-centreon-failover",permalink:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/centreon-ha/upgrade-from-centreon-failover",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-22.04/upgrade/centreon-ha/upgrade-from-centreon-failover.md",tags:[],version:"22.04",lastUpdatedAt:1696249546,formattedLastUpdatedAt:"Oct 2, 2023",frontMatter:{id:"upgrade-from-centreon-failover",title:"Upgrade from Centreon-Failover to Centreon-HA"},sidebar:"version-22.04/docs",previous:{title:"Upgrade Centreon HA from Centreon 21.10",permalink:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/centreon-ha/upgrade-centreon-ha-from-21-10"},next:{title:"Upgrading MariaDB",permalink:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-mariadb"}},c={},g=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Understanding",id:"understanding",level:3},{value:"Scope of application",id:"scope-of-application",level:3},{value:"Legacy Cluster destruction",id:"legacy-cluster-destruction",level:2},{value:"Upgrade MariaDB",id:"upgrade-mariadb",level:2},{value:"Upgrade Centreon Packages",id:"upgrade-centreon-packages",level:2},{value:"Create the new cluster",id:"create-the-new-cluster",level:2},{value:"Finalizing the upgrade",id:"finalizing-the-upgrade",level:3}],m={toc:g},h="wrapper";function f(e){var{components:t}=e,n=l(e,["components"]);return(0,r.kt)(h,s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"understanding"},"Understanding"),(0,r.kt)("p",null,"This procedure is reserved to advanced-users. Read it completely before starting any operation.\nMake sure to understand the whole thing as it helps to minimize service disruption when\nthe time to do it on production servers will come."),(0,r.kt)("h3",{id:"scope-of-application"},"Scope of application"),(0,r.kt)("p",null,"This procedure aims to provide a detailed guide on how to upgrade a Centreon version installed in version < 20.04 with\nthe centreon-failover solution deployed. "),(0,r.kt)("p",null,"If you never worked with Centreon Professional Services Team or one of our Partner, you are probably not concerned by the content\nbelow."),(0,r.kt)("p",null,"Please always open a support ticket to ensure that your platform is compliant with the upgrade process described here."),(0,r.kt)("h2",{id:"legacy-cluster-destruction"},"Legacy Cluster destruction"),(0,r.kt)("p",null,"To migrate from centreon-failover to centreon-ha, it's necessary to destroy the existing Cluster. Be aware that the\nWeb UI will be unavaible during this process."),(0,r.kt)("p",null,"Connect by SSH to a node within the Cluster to run the following command:"),(0,r.kt)("p",null,"Disable the resources: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource disable ms_mysql\npcs resource disable centreon\npcs resource unmanage centreon\npcs resource unmanage ms_mysql\n")),(0,r.kt)("p",null,"Destroy the cluster: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs cluster destroy\n")),(0,r.kt)("p",null,"At this step, none of the processes managed by the cluster should run on any node."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"WARNING:")," Make sure to check on both Central and Database servers. ")),(0,r.kt)("h2",{id:"upgrade-mariadb"},"Upgrade MariaDB"),(0,r.kt)("p",null,"Centreon >= 22.04 comes with a compatibility with MariaDB 10.5."),(0,r.kt)("p",null,"Upgrade of both database nodes following ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-10#Upgrade-the-MariaDB-server"},"official MariaDB upgrade procedure"),". "),(0,r.kt)("p",null,"Once both nodes are running the 10.5 MariaDB version, stop mysql/mariadb processes. "),(0,r.kt)("h2",{id:"upgrade-centreon-packages"},"Upgrade Centreon Packages"),(0,r.kt)("p",null,"Follow these steps on each Central Web nodes."),(0,r.kt)("p",null,"If you upgrade from the 19.10: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-10#update-the-centreon-repository"},"Update your repositories"),". Also those of the Business Edition modules if installed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-10#upgrade-the-centreon-solution"},"Update your packages")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-10#additional-actions"},"Take required additional actions"))),(0,r.kt)("p",null,"If you upgrade from the 19.04: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-04#update-the-centreon-repository"},"Update your repositories"),". Also those of the Business Edition modules if installed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-04#upgrade-the-centreon-solution"},"Update your packages")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-04#additional-actions"},"Take required additional actions"))),(0,r.kt)("p",null,"Stop the apache process after these operations and check again that none of the\nprocesses managed by the cluster are running."),(0,r.kt)("h2",{id:"create-the-new-cluster"},"Create the new cluster"),(0,r.kt)("p",null,"Depending on your Cluster architecture, the procedure to create the cluster is different. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the webserver and the databases are running on the same node, follow this ",(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-2-nodes#setting-up-the-centreon-cluster"},"installation guide of HA 2 nodes")),(0,r.kt)("li",{parentName:"ul"},"If databases are running on a dedicated server, follow this ",(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-4-nodes#setting-up-the-centreon-cluster"},"installation guide of HA 4 nodes"))),(0,r.kt)("p",null,"Before taking the next steps, make sure that all resources are running smoothly without any failed actions."),(0,r.kt)("p",null,"If any problem shows up at this step, make sure that the following prerequisites are met: "),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"HA 2 nodes",label:"HA 2 nodes",mdxType:"TabItem"},(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-2-nodes#ssh-keys-exchange"},"SSH key exchange"),", Centreon-HA is more secured as it does not requires root privileges"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-2-nodes#creating-the-centreon-mariadb-account"},"Database credentials and privileges"),", same as above, root SQL account is not needed anymore  "))),(0,r.kt)(o.Z,{value:"HA 4 nodes",label:"HA 4 nodes",mdxType:"TabItem"},(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-4-nodes#ssh-keys-exchange"},"SSH key exchange"),", Centreon-HA is more secured as it does not requires root privileges"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-4-nodes#creating-the-centreon-mariadb-account"},"Database credentials and privileges"),", same as above, root SQL account is not needed anymore  ")))),(0,r.kt)("p",null,"Once the centreon and mysql SSH keys have been exchanged, you might want to remove the root SSH public keys from /root/.ssh/authorized_keys."),(0,r.kt)("h3",{id:"finalizing-the-upgrade"},"Finalizing the upgrade"),(0,r.kt)("p",null,"First, complete Web wizard steps to finish the Central upgrade process:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you upgrade from the 19.10, follow this ",(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-10#finalizing-the-upgrade"},"chapter"),"."),(0,r.kt)("li",{parentName:"ul"},"If you upgrade from the 19.04, follow this ",(0,r.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-04#finalizing-the-upgrade"},"chapter"),".")),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"HA 2 nodes",label:"HA 2 nodes",mdxType:"TabItem"},(0,r.kt)("p",null,"Then, modify the Centreon-Broker reload command of your Central Server in 'Configuration > Pollers' as described ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-2-nodes#customizing-poller-reload-command"},"here"),".")),(0,r.kt)(o.Z,{value:"HA 4 nodes",label:"HA 4 nodes",mdxType:"TabItem"},(0,r.kt)("p",null,"Then, modify the Centreon-Broker reload command of your Central Server in 'Configuration > Pollers' as described ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/installation/installation-of-centreon-ha/installation-4-nodes#customizing-poller-reload-command"},"here"),"."))),(0,r.kt)("p",null,"Finally, upgrade your Poller(s) as described ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2665/docs/upgrade/upgrade-from-19-04#upgrade-the-poller"},"here")))}f.isMDXComponent=!0}}]);